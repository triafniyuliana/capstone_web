{% extends "base.html" %}
{% block title %}Booking - Teman Tukang{% endblock %}
{% set active_page = 'dashboard' %}

{% block custom_css %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  .booking-wrap { max-width:1100px; margin:30px auto; padding:0 16px; }
  .card-booking { background:#fff; border-radius:12px; padding:20px; box-shadow:0 8px 20px rgba(0,0,0,0.06); }
  .price-chip { border:1px solid #eee; padding:8px 12px; border-radius:10px; display:inline-flex; align-items:center; gap:8px; cursor:pointer; margin-right:8px; }
  .swal2-popup { border-radius:8px; }
  .swal2-confirm { background:#ff8c00 !important; border:none !important; }
</style>
{% endblock %}

{% block content %}
<div class="booking-wrap">
  <div class="row g-4">
    <div class="col-lg-12">
      <div class="card-booking">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 class="mb-0">Jam Operasional 07:00 - 24:00</h5>
          <small class="text-muted">Pilih tanggal, jam, & harga</small>
        </div>

        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            {% for category, msg in messages %}
              <div class="alert alert-{{ category }} py-2">{{ msg }}</div>
            {% endfor %}
          {% endif %}
        {% endwith %}

        <form method="POST" id="bookingForm" class="row g-3">
          <div class="col-md-6">
            <label class="form-label">Pilih Tanggal</label>
            <input name="date" type="date" class="form-control" required />
          </div>

          <div class="col-md-6">
            <label class="form-label">Pilih Waktu</label>
            <input name="time" id="time" type="time" class="form-control" step="60" required />
            <div class="form-text">Waktu operasional: 07:00 - 24:00</div>
          </div>

          <div class="col-12">
            <label class="form-label">Harga Penawaran</label>
            <div class="mb-2">
              <label class="price-chip"><input type="radio" name="price_option" value="250000" checked /> Rp. 250.000</label>
              <label class="price-chip"><input type="radio" name="price_option" value="300000" /> Rp. 300.000</label>
              <label class="price-chip"><input type="radio" name="price_option" value="custom" /> Custom</label>
            </div>

            <div class="d-flex gap-2">
              <input id="customPrice" name="custom_price" type="number" class="form-control" placeholder="Input budget (mis: 500000)" min="0" style="max-width:360px" />
              <div class="form-check ms-2">
                <input class="form-check-input" type="checkbox" required />
                <label class="form-check-label small text-muted">Syarat & Ketentuan</label>
              </div>
            </div>
          </div>

          <div class="col-12">
            <button id="pesanBtn" type="submit" class="btn" style="background:#ff8c00;color:white;font-weight:600;border-radius:8px;">
              Pesan
            </button>
          </div>
        </form>

      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block custom_js %}
<!-- SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const form = document.getElementById('bookingForm');
  const btn = document.getElementById('pesanBtn');
  if (!form || !btn) return;

  btn.addEventListener('click', function (e) {
    e.preventDefault();

    if (!form.checkValidity()) {
      form.reportValidity();
      return;
    }

    // simple nice popup
    Swal.fire({
      title: 'Berhasil!',
      text: 'Pesanan Anda akan diproses.',
      icon: 'success',
      confirmButtonText: 'OK',
      showClass: { popup: 'swal2-show' },
      hideClass: { popup: 'swal2-hide' }
    }).then(function (res) {
      if (res.isConfirmed) {
        if (typeof form.requestSubmit === 'function') form.requestSubmit();
        else form.submit();
      }
    });
  });
});
</script>
{% endblock %}
