{% extends "base.html" %}
{% block title %}Beranda - Teman Tukang{% endblock %}
{% set active_page = 'dashboard' %}

{% block custom_css %}
<style>
    /* --- HERO SECTION --- */
    .hero-section {
        width: 100%;
        height: 550px;
        background-image: url('https://assets.promediateknologi.id/crop/0x0:0x0/750x500/webp/photo/2023/02/11/969053708.jpeg');
        background-size: cover;
        background-position: center;
        position: relative;
        border-radius: 0 0 10px 10px;
    }

    .hero-overlay {
        position: absolute;
        inset: 0;
        background-color: rgba(255, 255, 255, 0.7);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        padding: 20px;
    }

    .hero-title {
        font-size: 2.5rem;
        font-weight: bold;
        color: #ff8c00;
        margin-bottom: 10px;
    }

    .hero-subtitle {
        font-size: 1.1rem;
        color: #3d3d3d;
        max-width: 650px;
        margin-bottom: 25px;
    }

    .hero-btn {
        background-color: #ff8c00;
        color: white;
        padding: 12px 25px;
        border-radius: 30px;
        font-weight: 600;
        text-decoration: none;
        transition: 0.2s;
        border: none;
    }
    .hero-btn:hover {
        background-color: #e67e00;
        transform: translateY(-2px);
    }

    /* --- ARTICLE CARDS --- */
    .content-title {
        font-size: 1.6rem;
        font-weight: 600;
        margin: 40px 0 25px 0;
        text-align: center;
        color: #333;
    }

    .article-card {
        display: flex;
        flex-direction: column;
        background: white;
        border-radius: 10px;
        border: 1px solid #eee;
        box-shadow: 0 2px 6px rgba(0, 0, 0, .08);
        overflow: hidden;
        transition: 0.2s;
    }

    .article-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, .12);
    }

    .article-card img {
        width: 100%;
        height: auto;
        object-fit: cover;
    }

    .article-content {
        padding: 18px 22px;
    }

    .article-card h5 {
        color: #ff8c00;
        font-weight: 600;
        margin-bottom: 10px;
    }

    .card-btn {
        display: block;
        width: fit-content;
        margin: 12px auto 0 auto;
        background-color: #ff8c00;
        padding: 8px 16px;
        border-radius: 25px;
        color: white;
        font-weight: 600;
        text-decoration: none;
        transition: 0.2s;
    }
    .card-btn:hover {
        background-color: #e67e00;
    }

    .cards-row {
        display: flex;
        gap: 20px;
    }

    /* --- RENOVASI & PERAWATAN --- */
    .renovasi-card {
        display: flex;
        align-items: center;
        padding: 18px;
        background: #fafafa;
        border-radius: 12px;
        margin-bottom: 18px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.08);
        position: relative;
    }

    .renovasi-card img {
        width: 130px;
        height: 90px;
        object-fit: cover;
        border-radius: 10px;
        margin-right: 15px;
    }

    .renovasi-content h5 {
        font-size: 1.1rem;
        color: #222;
        margin-bottom: 5px;
        font-weight: 600;
    }

    .renovasi-content p {
        font-size: 0.92rem;
        margin: 0;
        color: #555;
    }

    .renovasi-btn {
        position: absolute;
        right: 15px;
        bottom: 15px;
        background: #ff8c00;
        color: white;
        padding: 8px 16px;
        font-size: 0.85rem;
        border-radius: 20px;
        text-decoration: none;
        font-weight: 600;
    }

    .renovasi-btn:hover {
        background: #e67e00;
    }

    /* MOBILE */
    @media (max-width: 768px) {
        .cards-row {
            flex-direction: column;
        }

        .renovasi-card {
            flex-direction: column;
            align-items: flex-start;
            padding-bottom: 55px;
        }

        .renovasi-card img {
            width: 100%;
            height: 150px;
            margin-bottom: 12px;
        }

        .renovasi-btn {
            bottom: 12px;
            right: 12px;
        }
    }
/* --- FLOATING CHAT BUTTON --- */
.floating-chat-btn {
    position: fixed;
    bottom: 25px;
    right: 25px;
    width: 65px;
    height: 65px;
    background: #ff8c00;
    border-radius: 50%;
    color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 2rem;
    cursor: pointer;
    box-shadow: 0 5px 18px rgba(0,0,0,0.25);
    z-index: 1000;
    transition: 0.25s;
}
.floating-chat-btn:hover {
    transform: scale(1.1);
}

/* --- CHAT POPUP --- */
.chat-popup {
    display: none;
    position: fixed;
    bottom: 100px;
    right: 25px;
    width: 330px;
    height: 460px;
    background: white;
    border-radius: 18px;
    box-shadow: 0 7px 25px rgba(0,0,0,0.25);
    overflow: hidden;
    z-index: 1050;
    flex-direction: column;
    animation: fadeUp 0.35s ease;
}

/* Animasi smooth */
@keyframes fadeUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

/* HEADER */
.chat-header {
    background: #ff8c00;
    color: white;
    padding: 12px 18px;
    font-weight: 600;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.chat-header .close-btn {
    background: transparent;
    border: none;
    color: white;
    font-size: 1.4rem;
    cursor: pointer;
}
.chat-header .close-btn:hover {
    transform: scale(1.15);
}

/* CHAT BODY */
.chat-body {
    flex: 1;
    padding: 15px;
    overflow-y: auto;
    background: #fafafa;
}

/* MESSAGE BUBBLES */
.message {
    padding: 10px 15px;
    border-radius: 18px;
    font-size: 0.93rem;
    max-width: 80%;
    margin-bottom: 12px;
}

.message.user {
    align-self: flex-end;
    background: #ffeed9;
    border-bottom-right-radius: 6px;
}

.message.bot {
    align-self: flex-start;
    background: #eaeaea;
    border-bottom-left-radius: 6px;
}

/* INPUT AREA */
.chat-input-area {
    padding: 12px;
    background: #fff;
    display: flex;
    gap: 10px;
    border-top: 1px solid #ddd;
}

.chat-input-area input {
    flex: 1;
    padding: 10px 14px;
    border-radius: 25px;
    border: 1px solid #ccc;
}

.chat-input-area button {
    background: #ff8c00;
    border: none;
    color: white;
    padding: 10px 14px;
    border-radius: 50%;
    font-size: 1.2rem;
    cursor: pointer;
}
.chat-input-area button:hover {
    background: #e67e00;

    }
</style>
{% endblock %}

{% block content %}

<div class="container-fluid p-0">
    <div class="hero-section">
        <div class="hero-overlay">
            <h1 class="hero-title">Selamat Datang!</h1>
            <p class="hero-subtitle">
                Temukan layanan tukang profesional dan terpercaya untuk semua kebutuhan renovasi dan perbaikan Anda.
                Ingin mendapatkan tukang yang cocok berdasarkan permasalahan rumahmu?
            </p>
            <a href="{{ url_for('deteksi') }}" class="hero-btn">Temukan Tukang</a>
        </div>
    </div>
</div>

<h3 class="content-title">Panduan Pengguna</h3>

<div class="container mb-5">
    <div class="cards-row">

        <!-- CARD 1 -->
        <div class="article-card">
            <img src="https://testingindonesia.co.id/wp-content/uploads/2023/01/2.jpg">
            <div class="article-content">
                <h5>Cara Memesan Tukang Menggunakan Fitur Deteksi</h5>
                <ol>
                    <li>Buka menu Deteksi di aplikasi.</li>
                    <li>Unggah foto kerusakan rumahmu.</li>
                    <li>Tekan tombol Deteksi.</li>
                    <li>Lihat hasil analisis kerusakan.</li>
                    <li>Dapatkan rekomendasi tukang otomatis.</li>
                    <li>Pilih tukang & buka profilnya.</li>
                    <li>Tekan "Pesan Sekarang".</li>
                </ol>
                <a href="{{ url_for('deteksi') }}" class="card-btn">Coba Deteksi Sekarang</a>
            </div>
        </div>

        <!-- CARD 2 -->
        <div class="article-card">
            <img src="https://cloud.jpnn.com/photo/arsip/normal/2023/02/11/pt-semen-indonesia-persero-tbk-sig-menggelar-pelatihan-tata-es7i.jpg">
            <div class="article-content">
                <h5>Cara Menjadi Tukang Mitra</h5>
                <ol>
                    <li>Hubungi kami via WhatsApp.</li>
                    <li>Verifikasi data mitra.</li>
                    <li>Akun akan dibuatkan.</li>
                    <li>Login ke aplikasi Mitra.</li>
                    <li>Lengkapi profil & mulai bekerja.</li>
                </ol>
                <a href="https://wa.me/6281234567890" class="card-btn">Hubungi via WA</a>
            </div>
        </div>

    </div>
</div>

<h3 class="content-title">Cara Perawatan & Renovasi Rumah</h3>

<div class="container mb-5">

    <div class="renovasi-card">
        <img src="https://testingindonesia.co.id/wp-content/uploads/2023/01/2.jpg">
        <div>
            <h5>Cara Mengenali Kerusakan Rumah Sejak Dini</h5>
            <p>Belajar membaca tanda-tanda kerusakan rumah.</p>
        </div>
        <a href="{{ url_for('artikel_kerusakan') }}" class="renovasi-btn">Baca Selengkapnya</a>
    </div>

    <div class="renovasi-card">
        <img src="https://cloud.jpnn.com/photo/arsip/normal/2023/02/11/pt-semen-indonesia-persero-tbk-sig-
menggelar-pelatihan-tata-es7i.jpg">
        <div>
            <h5>Tips Renovasi Rumah Aman & Hemat</h5>
            <p>Cara merenovasi rumah dengan aman dan efisien.</p>
        </div>
        <a href="{{ url_for('artikel_renovasi') }}" class="renovasi-btn">Baca Selengkapnya</a>
    </div>

</div>

<!-- CHATBOT BUTTON -->
<div class="floating-chat-btn" id="openChatBtn">
    <i class="bi bi-robot"></i>
</div>

<!-- CHATBOT POPUP -->
<div class="chat-popup" id="chatPopup">

    <div class="chat-header">
        <span>Chatbot</span>
        <button id="closeChatBtn" class="close-btn">&times;</button>
    </div>

    <div class="chat-body">
        <div class="message bot">Halo! Ada yang bisa saya bantu hari ini? ðŸ¤–</div>
    </div>

    <div class="chat-input-area">
        <input type="text" id="userInput" placeholder="Tulis pesan...">
        <button id="sendBtn"><i class="bi bi-send"></i></button>
    </div>
</div>

<script>
const chatPopup = document.getElementById('chatPopup');
const openChatBtn = document.getElementById('openChatBtn');
const closeChatBtn = document.getElementById('closeChatBtn');
const chatBody = document.querySelector('.chat-body');
const userInput = document.getElementById('userInput');
const sendBtn = document.getElementById('sendBtn');

openChatBtn.onclick = () => chatPopup.style.display = 'flex';
closeChatBtn.onclick = () => chatPopup.style.display = 'none';

async function sendMessage() {
    const msg = userInput.value.trim();
    if (!msg) return;

    // User bubble
    let userMsg = document.createElement('div');
    userMsg.classList.add('message', 'user');
    userMsg.textContent = msg;
    chatBody.appendChild(userMsg);
    userInput.value = '';
    chatBody.scrollTop = chatBody.scrollHeight;

    // Loading bubble bot
    let botMsg = document.createElement('div');
    botMsg.classList.add('message', 'bot');
    botMsg.textContent = '...';
    chatBody.appendChild(botMsg);
    chatBody.scrollTop = chatBody.scrollHeight;

    try {
        const res = await fetch('/api/chat', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ message: msg })
        });
        const data = await res.json();
        botMsg.textContent = data.reply;
        chatBody.scrollTop = chatBody.scrollHeight;
    } catch (err) {
        botMsg.textContent = 'Maaf, tidak bisa menghubungi server.';
    }
}

sendBtn.onclick = sendMessage;
userInput.addEventListener("keypress", (e) => {
    if (e.key === "Enter") sendMessage();
});
</script>


{% endblock %}